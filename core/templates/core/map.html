{% extends 'core/base.html' %}

{% block title %}Map{% endblock %}

{% block content %}
<!-- Search bar and button -->
<div style="margin-bottom: 10px;">
    <input type="text" id="search-bar" placeholder="Search for a restaurant"
           style="padding: 10px; width: 300px; font-size: 14px;">
    <button id="search-button" style="padding: 10px; font-size: 14px;">Search</button>
</div>

<!-- Map display -->
<div id="map" style="height: 500px; width: 100%;"></div>

<script>
    let map;
    let service;
    let infowindow;

    function initMap() {
        // Default location (Atlanta)
        const userLocation = { lat: 33.7490, lng: -84.3880 };

        // Initialize the map centered at the user location
        map = new google.maps.Map(document.getElementById('map'), {
            center: userLocation,
            zoom: 13
        });

        // Initialize Places service
        service = new google.maps.places.PlacesService(map);

        // Handle search button click
        document.getElementById('search-button').addEventListener('click', function() {
            const query = document.getElementById('search-bar').value;
            searchPlaces(query);
        });
    }

    function searchPlaces(query) {
        const request = {
            query: query,  // Search term from input
            fields: ['name', 'geometry'], // Fetch the name and location
        };

        // Perform a text search
        service.findPlaceFromQuery(request, function(results, status) {
            if (status === google.maps.places.PlacesServiceStatus.OK && results) {
                const place = results[0];  // Get the first result
                if (place.geometry && place.geometry.location) {
                    // Center the map on the result location
                    map.setCenter(place.geometry.location);
                    map.setZoom(15);

                    // Clear existing markers
                    clearMarkers();

                    // Add a marker for the place found
                    const marker = new google.maps.Marker({
                        position: place.geometry.location,
                        map: map,
                        title: place.name
                    });

                    // Show info window on marker click
                    infowindow = new google.maps.InfoWindow({
                        content: place.name
                    });
                    marker.addListener('click', function() {
                        infowindow.open(map, marker);
                    });
                }
            } else {
                alert('Place not found');
            }
        });
    }

    // Optional: Function to clear existing markers if you want to reset the map
    function clearMarkers() {
        // Implement logic to clear any existing markers if needed
    }
</script>

<!-- Load Google Maps API with Places Library -->
<script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBRWVo1v50HrzJZ_ckYSR7WbR3vWwroh0Q&libraries=places&callback=initMap">
</script>

{% endblock %}
